{% extends "base.html" %}

{% block title %}Create Order - Fruit Store Management{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-plus"></i> Create New Order</h5>
            </div>
            <div class="card-body">
                <form method="post" action="/orders/create">
                    <div class="mb-3">
                        <label for="customerId" class="form-label">Customer *</label>
                        <select class="form-control" id="customerId" name="customerId" required>
                            <option value="">Select Customer</option>
                            {% for customer in customers %}
                            <option value="{{ customer.customerId }}">{{ customer.name }} ({{ customer.customerId }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label for="fruitId" class="form-label">Fruit *</label>
                            <select class="form-control" id="fruitId" name="fruitId" required onchange="updatePrice()">
                                <option value="">Select Fruit</option>
                                {% for fruit in fruits %}
                                <option value="{{ fruit._id }}" data-price="{{ fruit.pricePerKg }}" data-stock="{{ fruit.stockKg }}">
                                    {{ fruit.name }} - ${{ "%.2f"|format(fruit.pricePerKg) }}/kg (Stock: {{ fruit.stockKg }}kg)
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="quantityKg" class="form-label">Quantity (Kg) *</label>
                            <input type="number" step="0.1" class="form-control" id="quantityKg" name="quantityKg" required onchange="updateTotal()">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="status" class="form-label">Status *</label>
                            <select class="form-control" id="status" name="status" required>
                                <option value="Pending">Pending</option>
                                <option value="Shipped">Shipped</option>
                                <option value="Completed">Completed</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Estimated Total</label>
                            <div class="form-control-plaintext bg-light rounded p-2">
                                <strong id="totalAmount">$0.00</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="/orders" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to List
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Create Order
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function updatePrice() {
    updateTotal();
}

function updateTotal() {
    const fruitSelect = document.getElementById('fruitId');
    const quantityInput = document.getElementById('quantityKg');
    const totalElement = document.getElementById('totalAmount');
    
    const selectedOption = fruitSelect.selectedOptions[0];
    if (selectedOption && selectedOption.dataset.price && quantityInput.value) {
        const price = parseFloat(selectedOption.dataset.price);
        const quantity = parseFloat(quantityInput.value);
        const total = price * quantity;
        totalElement.textContent = '$' + total.toFixed(2);
    } else {
        totalElement.textContent = '$0.00';
    }
}
</script>
{% endblock %}